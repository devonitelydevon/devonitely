<!DOCTYPE html>
<html>
	<head>
		<title>Devonitely</title>
		<meta charset="utf-8">
	    <meta property="og:title" content="Countdown to Dev!" />
	    <meta property="og:image" content="res/devonitelypic.jpeg" />
	    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAC6OtDpjTVq_jtJ-sSVp9YzdvjVn6YEKI"></script>
		<style>
			p {
			  text-align: center;
			  font-size: 60px;
			  margin-top:0px;
			}
		</style>
	</head>
	<body>
		<br/>
		<p id="timer">00:00:00:00</p>
		<br/>
		<br/>
		<div>
			<img src="res/devonitelybackground.JPG" alt="Dev Diggity" style="height:40%;width:40%;display:block;margin-left:auto;margin-right:auto;">
		</div>
		<br/>
		<p id="prettiest"></p>
		<script>
			var reunionDate;
			var geocoder;
			var city;
			var state;
			updateTime();

			function updateTime()
			{
				if (!reunionDate)
				{
					reunionDate = getReunionDate()
				}

				var diffMs = Math.abs(reunionDate - new Date())

				var days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
				var hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
				var minutes = Math.floor((diffMs % (1000 * 60 * 60)) / (1000 * 60));
				var seconds = Math.floor((diffMs % (1000 * 60)) / 1000);

				document.getElementById("timer").innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s"

				if (minutes % 5 == 0 || !city || !state)
				{
					getLocation()
					// prettiestGirl(null)
				}

				setTimeout(updateTime, 1000)
			}

			function getReunionDate()
			{
				var utc = new Date()
				utc.setUTCFullYear(2018)
				utc.setUTCMonth(6)
				utc.setUTCDate(2)
				utc.setUTCHours(10)
				utc.setUTCMinutes(35)
				utc.setUTCSeconds(0)
				utc.setUTCMilliseconds(0)

				return utc
				// 7/2/18 4:35 AM MST
				// 7/2/18 10:35 AM UTC
			}

			function getLocation()
			{
				if ("geolocation" in navigator)
				{
					navigator.geolocation.getCurrentPosition(prettiestGirl)
				}
				else
				{
					console.log("unable to get location")
				}
			}

			function prettiestGirl(position)
			{
				if (!geocoder)
				{
					geocoder = new google.maps.Geocoder()
				}

				var lat = position.coords.latitude
				var lon = position.coords.longitude
				// var lat = 47.6306283
				// var lon = -122.1612227

				var latlng = new google.maps.LatLng(lat, lon)
				geocoder.geocode({'location': latlng}, function(results, status) {
					if (status == google.maps.GeocoderStatus.OK)
					{
						console.log(results)
						var gotCity = false
						var gotState = false
						for (var i = 0; i < results.length; i++)
						{
							var result = results[i]

							if (result.types[0] == 'locality')
							{
								for (var j = 0; j < result.address_components.length; j++)
								{
									if (result.address_components[j].types[0] == 'locality')
									{
										city = result.address_components[j].long_name
										gotCity = true
										console.log("City: " + city)
									}
									if (result.address_components[j].types[0] == 'administrative_area_level_1')
									{
										state = result.address_components[j].long_name
										gotState = true
										console.log("State: " + state)
									}

									if (gotCity && gotState)
									{
										break
									}
								}
								break
							}
						}

						document.getElementById("prettiest").innerHTML = "How's it feel to be the prettiest girl in " + city + ", " + state + "?";
					}
				});
			}

		</script>

	</body>
</html>
